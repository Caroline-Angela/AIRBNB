<h1>Dashboard</h1>
<p>Welcome to your dashboard,<strong> <%= current_user.first_name %> </strong>  ! </p> <!-- email works for now, should change to user name later -->

<!-- booking table -->
<h2>Your Bookings</h2>
<% if @bookings.present? %>
  <table class="table">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Flats</th>
        <th scope="col">Start Date</th>
        <th scope="col">End Date</th>
        <th scope="col">Status</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @bookings.each do |booking| %>
        <tr>
          <td><%= booking.flat.title %></td>
          <td><%= booking.start_date %></td>
          <td><%= booking.end_date %></td>
          <td><%= booking.status %></td>
          <td>
            <%= link_to 'Show Flat', booking_path(booking), class: 'btn btn-primary' %>
            <%= link_to 'Cancel', booking, data: { turbo_method: :delete }, class: 'btn btn-danger' %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No bookings found.</p>
<% end %>

<h2>Your Flats</h2>
<% if @flats.present? %>
  <table class="table">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Flats</th>
        <th scope="col">Start Date</th>
        <th scope="col">End Date</th>
        <th scope="col">Status</th>

        <th scope="col">Who ?</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @flats.each do |flat| %>
          <% flat.bookings.each do |booking| %>
        <tr>
          <td><%= booking.flat.title %></td>
          <td><%= booking.start_date %></td>
          <td><%= booking.end_date %></td>
          <td><%= booking.status %></td>

          <td><%= booking.user.first_name %> <%= booking.user.last_name %></td>
          <td>
            <%= link_to 'Show Flat', booking_path(booking), class: 'btn btn-primary' %>
            <%= link_to 'Delete Booking', booking, data: { turbo_method: :delete }, class: 'btn btn-danger' %>
            <%= link_to 'Accept', accept_booking_path(booking), data: {turbo_method: :patch}, class: 'btn btn-success' %>
          </td>
        </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No bookings found.</p>
<% end %>

<%= link_to "Add a New Flat", new_flat_path, class: "btn btn-dark" %>
